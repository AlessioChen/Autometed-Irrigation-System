{%extends 'plant/base.html'%}

{% block content %}


<style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
</style>

<div style="width:60%; height: 60%;">
    <canvas id="canvas"></canvas>
</div>
<br>
<br>
<button id="randomizeData">Randomize Data</button>
<button id="addDataset">Add Dataset</button>
<button id="removeDataset">Remove Dataset</button>
<button id="addData">Add Data</button>
<button id="removeData">Remove Data</button>

<button id='sensor 1'> Sensor 1 </button>
<button id='sensor 2'> Sensor 2 </button>
<button id='sensor 3'> Sensor 3 </button>
{% endblock %}

{% block scripts%}

<script>

    var config = {
        type: 'line',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            title: {
                display: true,
                //text: 'Chart.js Line Chart'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    type: 'time',
                    scaleLabel: {
                        display: true,
                        labelString: 'Time'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Value'
                    }
                }]
            }
        }
    };

    window.onload = function () {
        var ctx = document.getElementById('canvas').getContext('2d');
        window.myLine = new Chart(ctx, config);

        var today = new Date();
        var times = {{ times| safe
    }};
    var air_humidity = {{ air_humidity| safe}};
    var air_temperature = {{ air_temperature| safe}};
    var soil_humidity = {{ soil_humidity| safe}};

    var x = [];
    var air_u = [];
    var air_t = [];
    var soil_h = [];
    //Loop for take data 
    //x = times 
    for (let i = 0; i < times.length; i++) {
        year = String(times[i]).split(",")[0].split('-')[0];
        month = String(times[i]).split(",")[0].split('-')[1];
        day = String(times[i]).split(",")[0].split('-')[2];


        hour = String(times[i]).split(",")[1].split(':')[0];
        minute = String(times[i]).split(",")[1].split(':')[1];

        var mydate = new Date(year, month - 1, day, hour, minute);

        x[i] = mydate
        air_u[i] = parseFloat(air_humidity[i]).toFixed(2);
        air_t[i] = parseFloat(air_temperature[i]).toFixed(2);
        soil_h[i] = parseFloat(soil_humidity[i]).toFixed(2);

    }
    config.data.labels = x;

    //Air Humidity
    var newDataset = {
        label: 'Air Humidity',
        backgroundColor: "blue",
        borderColor: "blue",
        data: air_u,
        fill: false
    }
    config.data.datasets.push(newDataset);

    //Air Temperature
    var newDataset = {
        label: 'Air Temperature',
        backgroundColor: "orange",
        borderColor: "orange",
        data: air_t,
        fill: false
    }
    config.data.datasets.push(newDataset);

    //Soil Humidity

    var newDataset = {
        label: 'Soil Humidity',
        backgroundColor: "green",
        borderColor: "green",
        data: soil_h,
        fill: false
    }

    config.data.datasets.push(newDataset);
    window.myLine.update();


    };


</script>
{% endblock %}